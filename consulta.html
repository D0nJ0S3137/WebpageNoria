<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GUIA ERROR ROUTE DASHBOARD</title>
  <link rel="stylesheet" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" type="text/css" href="consulta_styles.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Roboto:wght@400&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/gaugeJS/dist/gauge.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-lg" style="background-color: #FBB613;">
  <div class="container-fluid">
    <div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
      <ul class="navbar-nav">
        <a type="button" class="btn btn-dark btn-consistent-size me-2" href="/">
          <b>Página Principal</b>
        </a>
        <button type="button" class="btn btn-dark btn-consistent-size" data-bs-toggle="modal" data-bs-target="#instructionsModal">
          <b>Manual de Usuario</b>
        </button>
      </ul>
    </div>  
  </div>        
</nav>

<div class="container-map">
  <div class="row">
    <div class="col-12">
      <h1 class="text-center my-1 small-title">GUIA ERROR ROUTE DASHBOARD</h1>
      <h2 class="subtitle">Selecciona el rango de fecha y hora del trayecto para consultar el recorrido histórico del colectivo 2.</h2>
    </div>
  </div>
</div>

<div class="container">
  <div class="row justify-content-center mb-1">
    <div class="col-lg-8">
      <div class="card">
        <div class="card-body">
          <div id="timeWindowForm" class="row">
            <div class="col-md-4">
              <label for="startDateTime" class="form-label">Fecha y hora de inicio:</label>
              <input type="text" id="startDateTime" required>
            </div>
            <div class="col-md-4">
              <label for="endDateTime" class="form-label">Fecha y hora de fin:</label>
              <input type="text" id="endDateTime" required>
            </div>
            <span id="startDateSpan"></span> <span id="startTimeSpan"></span>
            <span id="endDateSpan"></span> <span id="endTimeSpan"></span>
            <div class="col-md-4 d-flex align-items-end"> 
              <button type="submit" id="submitButton" class="btn btn-custom btn-sm w-100" style="background-color: #000000; color: white;">Mostrar Rutas</button>
            </div>
            <div id="errorStats" class="mt-3 p-2 border rounded bg-light">
              <h5><b>Estadísticas de Error</b></h5>
              <div id="errorContent">No hay error calculado aún.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="instructionsModal" tabindex="-1" aria-labelledby="instructionsModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="instructionsModalLabel">Cómo usar el sistema</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Bienvenido al dashboard de rutas. Aquí debes:
        <ul>
          <li>Seleccionar la fecha y hora de inicio y fin del recorrido.</li>
          <li>Presionar "Mostrar Rutas".</li>
          <li>Usar el deslizador para revisar paso a paso el recorrido.</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row justify-content-center my-3">
    <div class="col-lg-8">
      <input type="range" class="form-range" min="0" max="100" value="0" id="timeSlider">
    </div>
  </div>
  <div class="row">
    <div class="col-12" style="position: relative;">
      <div id="mapid" style="height: 70vh; width: 100%;"></div>
      <div id="gaugeContainer">
        <div id="titleRpmGauge">Tacómetro RPM</div>
        <canvas id="rpmGaugeMap"></canvas>
      </div>
      <div id="vehicleInfo" style="position: absolute; top: 10px; right: 20px; background: white; padding: 10px; border: 1px solid black; z-index: 1000;">
        <p><strong>Fecha de paso:</strong> <span id="fechaPaso"></span></p>
        <p><strong>Hora de paso:</strong> <span id="horaPaso"></span></p>
        <p style="display: none;"><strong>RPM:</strong> <span id="rpmInfo"></span></p>
      </div>
    </div>     
  </div>
</div>

<a href="/" class="homeBtn material-icons">home</a>
<span class="infoBtn material-icons" data-bs-toggle="modal" data-bs-target="#instructionsModal">info</span>
<div id="dateError" class="text-danger"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-polylinedecorator/dist/leaflet.polylineDecorator.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="consulta.js"></script>

<script>
flatpickr("#startDateTime", {
  enableTime: true,
  dateFormat: "Y-m-dTH:i",
  altInput: true,
  altFormat: "Y-m-d H:i",
  altInputClass: "form-control form-control-sm",
  onChange: function(selectedDates) {
    endFlatpickr.set('minDate', selectedDates[0]);
  }
});

const endFlatpickr = flatpickr("#endDateTime", {
  enableTime: true,
  dateFormat: "Y-m-dTH:i",
  altInput: true,
  altFormat: "Y-m-d H:i",
  altInputClass: "form-control form-control-sm",
  minDate: "today"
});

document.addEventListener('DOMContentLoaded', () => {
  const submitButton = document.getElementById('submitButton');
  submitButton.addEventListener('click', (event) => {
    event.preventDefault();
    const startDateTime = document.getElementById('startDateTime').value;
    const endDateTime = document.getElementById('endDateTime').value;
    updateDateTimeDisplay(startDateTime, endDateTime);
    cargarDatos2(startDateTime, endDateTime, myMap);
  });
});
</script>
</body>
</html>
